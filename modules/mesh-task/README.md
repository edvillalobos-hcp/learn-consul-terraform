# Mesh Task

This module deploys an application task as part of the service mesh.
It is designed so you can easily modify existing [`ecs_task_definition`](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecs_task_definition)
resources to use this module instead.

See https://www.consul.io/docs/ecs for additional documentation.
## Requirements

No requirements.

## Providers

| Name | Version |
|------|---------|
| <a name="provider_aws"></a> [aws](#provider\_aws) | n/a |

## Modules

No modules.

## Resources

| Name | Type |
|------|------|
| [aws_ecs_task_definition.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecs_task_definition) | resource |
| [aws_iam_policy.execution](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_policy) | resource |
| [aws_iam_role.execution](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role) | resource |
| [aws_iam_role.task](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role) | resource |
| [aws_iam_role_policy_attachment.additional_execution_policies](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role_policy_attachment) | resource |
| [aws_iam_role_policy_attachment.additional_task_policies](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role_policy_attachment) | resource |
| [aws_iam_role_policy_attachment.execution](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role_policy_attachment) | resource |
| [aws_secretsmanager_secret.service_token](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/secretsmanager_secret) | resource |
| [aws_secretsmanager_secret_version.service_token](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/secretsmanager_secret_version) | resource |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_acl_secret_name_prefix"></a> [acl\_secret\_name\_prefix](#input\_acl\_secret\_name\_prefix) | The prefix of Secrets Manager secret names created by the ACL controller. If secret prefix is provided, we assume the secrets are generated by the ACL controller and follow the '<secret\_prefix>-<task-family>' naming convention. | `string` | `""` | no |
| <a name="input_acls"></a> [acls](#input\_acls) | Whether to enable ACLs for the mesh task. | `bool` | `false` | no |
| <a name="input_additional_execution_role_policies"></a> [additional\_execution\_role\_policies](#input\_additional\_execution\_role\_policies) | List of additional policy ARNs to attach to the execution role. | `list(string)` | `[]` | no |
| <a name="input_additional_task_role_policies"></a> [additional\_task\_role\_policies](#input\_additional\_task\_role\_policies) | List of additional policy ARNs to attach to the task role. | `list(string)` | `[]` | no |
| <a name="input_consul_client_token_secret_arn"></a> [consul\_client\_token\_secret\_arn](#input\_consul\_client\_token\_secret\_arn) | The ARN of the Secrets Manager secret where the Consul client token is stored. | `string` | `""` | no |
| <a name="input_consul_datacenter"></a> [consul\_datacenter](#input\_consul\_datacenter) | The name of the Consul datacenter the client belongs to | `string` | `"dc1"` | no |
| <a name="input_consul_ecs_image"></a> [consul\_ecs\_image](#input\_consul\_ecs\_image) | consul-ecs Docker image. | `string` | `"docker.mirror.hashicorp.services/hashicorp/consul-ecs:0.1.2"` | no |
| <a name="input_consul_image"></a> [consul\_image](#input\_consul\_image) | Consul Docker image. | `string` | `"docker.mirror.hashicorp.services/hashicorp/consul:1.10.2"` | no |
| <a name="input_consul_server_ca_cert_arn"></a> [consul\_server\_ca\_cert\_arn](#input\_consul\_server\_ca\_cert\_arn) | The ARN of the Secrets Manager secret containing the Consul server CA certificate. | `string` | `""` | no |
| <a name="input_container_definitions"></a> [container\_definitions](#input\_container\_definitions) | Application container definitions (https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task_definition_parameters.html#container_definitions). | `list(any)` | n/a | yes |
| <a name="input_envoy_image"></a> [envoy\_image](#input\_envoy\_image) | Envoy Docker image. | `string` | `"docker.mirror.hashicorp.services/envoyproxy/envoy-alpine:v1.16.2"` | no |
| <a name="input_family"></a> [family](#input\_family) | Task definition family (https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task_definition_parameters.html#family). This name will also be used as the Consul service name. | `string` | n/a | yes |
| <a name="input_gossip_key_secret_arn"></a> [gossip\_key\_secret\_arn](#input\_gossip\_key\_secret\_arn) | The ARN of the Secrets Manager secret containing the Consul gossip encryption key. | `string` | `""` | no |
| <a name="input_log_configuration"></a> [log\_configuration](#input\_log\_configuration) | Task definition log configuration object (https://docs.aws.amazon.com/AmazonECS/latest/APIReference/API_LogConfiguration.html). | `any` | `null` | no |
| <a name="input_outbound_only"></a> [outbound\_only](#input\_outbound\_only) | Whether the application only makes outward requests and does not receive any requests. Must be set to true if port is 0. | `bool` | `false` | no |
| <a name="input_port"></a> [port](#input\_port) | Port that the application listens on. If the application does not listen on a port, set outbound\_only to true. | `number` | `0` | no |
| <a name="input_retry_join"></a> [retry\_join](#input\_retry\_join) | Argument to pass to -retry-join (https://www.consul.io/docs/agent/options#_retry_join). This or consul\_server\_service\_name must be set. | `string` | n/a | yes |
| <a name="input_tags"></a> [tags](#input\_tags) | A map of tags to add to all resources. | `map(string)` | `{}` | no |
| <a name="input_tls"></a> [tls](#input\_tls) | Whether to enable TLS for the mesh-task for the control plane traffic. | `bool` | `false` | no |
| <a name="input_upstreams"></a> [upstreams](#input\_upstreams) | Upstream services this service will call. In the form [{destination\_name = $name, local\_bind\_port = $port}] where<br>destination\_name is the name of the upstream service and local\_bind\_port is the local port that this application should<br>use when calling the upstream service. | <pre>list(<br>    object({<br>      destination_name = string<br>      local_bind_port  = number<br>    })<br>  )</pre> | `[]` | no |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_task_definition_arn"></a> [task\_definition\_arn](#output\_task\_definition\_arn) | n/a |
